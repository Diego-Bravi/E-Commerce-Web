<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Shopping</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="navbar">
        <div class="logo">
            <img src="/assets/logo.png">
        </div>
        <div class="categories">
            <button data-category="all">All Products</button>
            <button data-category="women's clothing">Women'sClothing</button>
            <button data-category="men's clothing">Men's Clothing</button>
            <button data-category="electronics">Electronics</button>
            <button data-category="jewelery">Jewelery</button>
        </div>
        <div class="cart">
            <button><a href="cart/cart.html"><img src="/assets/shopping-cart.png"></a></button>
        </div>
        <div class="logout">
            <button><a href="/login/login.html"><img src="/assets/logout.png"></a></button>
        </div>
    </div>

    <div id="product-list"></div>

    <script>
        const productListDiv = document.getElementById('product-list');
        let currentCategory = 'all';
    
        document.addEventListener('DOMContentLoaded', () => {
            const categoryButtons = document.querySelectorAll('.categories button');
    
            categoryButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    event.preventDefault();
                    currentCategory = button.getAttribute('data-category');
                    fetchAndDisplayProducts(currentCategory);
                });
            });
    
            productListDiv.addEventListener('click', (event) => {
                if (event.target.classList.contains('add-to-cart-button')) {
                    const productDiv = event.target.closest('.card');
                    const product = {
                        title: productDiv.querySelector('h2').textContent,
                        price: parseFloat(productDiv.querySelector('p').textContent.replace('Price: $', '')), 
                    };
                    const quantity = parseInt(productDiv.querySelector('.quantity-input').value, 10);
                    addToCart(product, quantity);
                }
            });
    
            fetchAndDisplayProducts(currentCategory);
        });
    
        const addToCart = (product, quantity) => {
            let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    
            const existingProductIndex = cartItems.findIndex(item => item.title === product.title);
    
            if (existingProductIndex !== -1) {
                cartItems[existingProductIndex].quantity += quantity;
            } else {
                cartItems.push({ ...product, quantity });
            }
    
            localStorage.setItem('cart', JSON.stringify(cartItems));
        }
    
        const fetchAndDisplayProducts = (category) => {
            let apiUrl = 'https://fakestoreapi.com/products';
    
            if (category !== 'all') {
                apiUrl += `/category/${category}`;
            }
    
            fetch(apiUrl)
                .then(res => res.json())
                .then(products => {
                    productListDiv.innerHTML = '';
    
                    let rowDiv;
    
                    products.forEach((product, index) => {
                        if (index % 3 === 0) {
                            rowDiv = document.createElement('div');
                            rowDiv.classList.add('row');
                            productListDiv.appendChild(rowDiv);
                        }
    
                        const productDiv = document.createElement('div');
                        productDiv.classList.add('card');
                        productDiv.innerHTML = `
                            <img src="${product.image}" alt="${product.title}" />
                            <h2>${product.title}</h2>
                            <h4>Category: ${product.category}</h4>
                            <p>Price: $${product.price}</p>
                            <label for="quantity">Quantity:</label>
                            <input type="number" class="quantity-input" id="quantity" value="1" min="1">
                            <button class="add-to-cart-button">
                                
                            </button>
                        `;
                        rowDiv.appendChild(productDiv);
                    });
                })
                .catch(error => console.error('Error:', error));
        };
    </script>
</body>
</html>